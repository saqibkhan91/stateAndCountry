<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country and State Selector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            font-size: 16px;
        }
        select:disabled {
            background-color: #e9e9e9;
        }
        .flag {
            width: 20px;
            height: 20px;
            vertical-align: middle;
            margin-right: 8px;
        }
        .selected-flag {
            display: block;
            width: 200px;
            height: 200px;
            margin: 20px auto;
            object-fit: contain;
        }
        .selection-message {
            text-align: center;
            color: #333;
            font-size: 18px;
            margin-top: 10px;
        }
        option {
            padding: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Select Country and State</h1>
    <div class="form-group">
        <label for="country">Country:</label>
        <select id="country" name="country">
            <option value="">Select a country</option>
        </select>
    </div>
    <div class="form-group">
        <label for="state">State:</label>
        <select id="state" name="state" disabled>
            <option value="">Select a state</option>
        </select>
    </div>
    <div id="selection-output">
        <img id="selected-flag" class="selected-flag" style="display: none;">
        <p id="selection-message" class="selection-message"></p>
    </div>
</div>

<script src="countryAndStates.js"></script>
<script>
    const countrySelect = document.getElementById('country');
    const stateSelect = document.getElementById('state');
    const selectedFlag = document.getElementById('selected-flag');
    const selectionMessage = document.getElementById('selection-message');

    // Function to get flag emoji from iso2 code
    function getFlagEmoji(iso2) {
        if (!iso2) return '';
        const codePoints = iso2.toUpperCase().split('').map(char => 127397 + char.charCodeAt());
        return String.fromCodePoint(...codePoints);
    }

    // Populate country dropdown
    countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.iso2;
        const flag = country.flag ? `<img src="${country.flag}" alt="${country.name} flag" class="flag">` : getFlagEmoji(country.iso2);
        option.innerHTML = `${flag} ${country.name}`;
        countrySelect.appendChild(option);
    });

    // Event listener for country selection
    countrySelect.addEventListener('change', function() {
        const selectedCountryIso2 = this.value;
        if (selectedCountryIso2) {
            const selectedCountry = countries.find(country => country.iso2 === selectedCountryIso2);
            populateStates(selectedCountry.states);
            stateSelect.disabled = false;
            updateSelection(selectedCountry, null);
        } else {
            stateSelect.innerHTML = '<option value="">Select a state</option>';
            stateSelect.disabled = true;
            resetSelection();
        }
    });

    // Event listener for state selection
    stateSelect.addEventListener('change', function() {
        const selectedCountryIso2 = countrySelect.value;
        const selectedState = this.value;
        if (selectedCountryIso2 && selectedState) {
            const selectedCountry = countries.find(country => country.iso2 === selectedCountryIso2);
            updateSelection(selectedCountry, selectedState);
        } else {
            updateSelection(countries.find(country => country.iso2 === selectedCountryIso2), null);
        }
    });

    // Function to populate states dropdown
    function populateStates(states) {
        stateSelect.innerHTML = '<option value="">Select a state</option>';
        states.forEach(state => {
            const option = document.createElement('option');
            option.value = state;
            option.textContent = state;
            stateSelect.appendChild(option);
        });
    }

    // Function to update selection output
    function updateSelection(country, state) {
        if (country) {
            // Always use emoji as fallback if flag URL is unavailable or fails
            selectedFlag.src = country.flag || '';
            selectedFlag.alt = `${country.name} flag`;
            selectedFlag.style.display = country.flag ? 'block' : 'none';
            selectedFlag.onerror = () => {
                selectedFlag.style.display = 'none';
                selectionMessage.innerHTML = `<span style="font-size: 100px; display: block; margin: 20px auto; text-align: center;">${getFlagEmoji(country.iso2)}</span>` + selectionMessage.innerHTML;
            };
        } else {
            selectedFlag.style.display = 'none';
        }

        if (country && state) {
            selectionMessage.innerHTML = `Your country is <strong>${country.name}</strong> and your state is <strong>${state}</strong>.`;
        } else if (country) {
            selectionMessage.innerHTML = `Your country is <strong>${country.name}</strong>.`;
        } else {
            selectionMessage.textContent = '';
        }
    }

    // Function to reset selection output
    function resetSelection() {
        selectedFlag.style.display = 'none';
        selectionMessage.textContent = '';
    }
</script>
</body>
</html>